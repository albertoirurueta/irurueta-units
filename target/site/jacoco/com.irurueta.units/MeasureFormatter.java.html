<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MeasureFormatter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-units</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.units</a> &gt; <span class="el_source">MeasureFormatter.java</span></div><h1>MeasureFormatter.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2018 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.units;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.text.FieldPosition;
import java.text.MessageFormat;
import java.text.NumberFormat;
import java.text.ParseException;
import java.util.Locale;

/**
 * Base class to format and parse a given measure using its value and unit.
 * @param &lt;M&gt; type of measurement (i.e. Distance or Surface).
 * @param &lt;U&gt; type of unit (i.e. DistanceUnit or SurfaceUnit).
 */
public abstract class MeasureFormatter&lt;M extends Measurement, U extends Enum&gt; implements Cloneable {

    /**
     * Default pattern to format values and units together into a single string.
     * {0} corresponds to the value, {1} corresponds to the unit part.
     */
    public static final String DEFAULT_VALUE_AND_UNIT_FORMAT_PATTERN =
            &quot;{0} {1}&quot;;

    /**
     * Internal string formatter.
     */
    NumberFormat mNumberFormat;

    /**
     * Internal string formatter.
     */
    private MessageFormat mFormat;

    /**
     * Internal locale.
     */
    private Locale mLocale;

    /**
     * Pattern to format values and unit together into a single string. {0} corresponds to
     * the vlaue, {1} corresponds to the unit part.
     */
    private String mValueAndUnitFormatPattern;

    /**
     * Constructor.
     */
<span class="fc" id="L64">    MeasureFormatter() {</span>
<span class="fc" id="L65">        mNumberFormat = NumberFormat.getInstance();</span>
<span class="fc" id="L66">        mLocale = Locale.getDefault();</span>
<span class="fc" id="L67">        mValueAndUnitFormatPattern = DEFAULT_VALUE_AND_UNIT_FORMAT_PATTERN;</span>
<span class="fc" id="L68">    }</span>

    /**
     * Constructor with locale.
     * @param locale locale.
     * @throws IllegalArgumentException if locale is null.
     */
<span class="fc" id="L75">    MeasureFormatter(Locale locale) throws IllegalArgumentException {</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">        if (locale == null) {</span>
<span class="fc" id="L77">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L80">        mNumberFormat = NumberFormat.getInstance(locale);</span>
<span class="fc" id="L81">        mLocale = locale;</span>
<span class="fc" id="L82">        mValueAndUnitFormatPattern = DEFAULT_VALUE_AND_UNIT_FORMAT_PATTERN;</span>
<span class="fc" id="L83">    }</span>

    /**
     * Clones this measure formatter.
     * @return a copy of this unit formatter.
     */
    @Override
    public abstract Object clone();

    /**
     * Determines if two measure formatters are equal by comparing all of its internal
     * parameters.
     * @param obj another object to compare.
     * @return true if provided object is assumed to be equal to this instance.
     */
    @Override
    public boolean equals(Object obj) {
<span class="fc bfc" id="L100" title="All 2 branches covered.">        if (obj == null) {</span>
<span class="fc" id="L101">            return false;</span>
        }
<span class="fc bfc" id="L103" title="All 2 branches covered.">        if (!(obj instanceof MeasureFormatter)) {</span>
<span class="fc" id="L104">            return false;</span>
        }
<span class="fc bfc" id="L106" title="All 2 branches covered.">        if (this == obj) {</span>
<span class="fc" id="L107">            return true;</span>
        }

<span class="fc" id="L110">        MeasureFormatter other = (MeasureFormatter) obj;</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">        return mNumberFormat.equals(other.mNumberFormat) &amp;&amp;</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">                mLocale.equals(other.mLocale) &amp;&amp;</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">                mValueAndUnitFormatPattern.equals(other.mValueAndUnitFormatPattern);</span>
    }

    /**
     * Hash code generated for this instance.
     * Hash codes can be internally used by some collections to coarsely compare objects.
     * @return hash code.
     */
    @Override
    public int hashCode() {
<span class="fc" id="L123">        int hash = 7;</span>
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">        hash = 19 * hash + (mNumberFormat != null ?</span>
<span class="pc" id="L125">                mNumberFormat.hashCode() : 0);</span>
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">        hash = 19 * hash + (mFormat != null ? mFormat.hashCode() : 0);</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">        hash = 19 * hash + (mLocale != null ? mLocale.hashCode() : 0);</span>
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">        hash = 19 * hash + (mValueAndUnitFormatPattern != null ?</span>
<span class="pc" id="L129">                mValueAndUnitFormatPattern.hashCode() : 0);</span>
<span class="fc" id="L130">        return hash;</span>
    }

    /**
     * Formats provided measurement value and unit into a string representation.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @return string representation of provided measurement value and unit.
     */
    public String format(Number value, U unit) {
<span class="fc" id="L140">        return MessageFormat.format(mValueAndUnitFormatPattern,</span>
<span class="fc" id="L141">                mNumberFormat.format(value), getUnitSymbol(unit));</span>
    }

    /**
     * Formats provided measurement value and unit into a string representation
     * and appends the result into provided string buffer.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @param toAppendTo buffer to append the result to.
     * @param pos field position where result will be appended.
     * @return provided string buffer where result is appended.
     */
    public StringBuffer format(Number value, U unit,
                               StringBuffer toAppendTo, FieldPosition pos) {
<span class="fc bfc" id="L155" title="All 2 branches covered.">        if (mFormat == null) {</span>
<span class="fc" id="L156">            mFormat = new MessageFormat(mValueAndUnitFormatPattern);</span>
        }
<span class="fc" id="L158">        return mFormat.format(new Object[]{mNumberFormat.format(value),</span>
<span class="fc" id="L159">                getUnitSymbol(unit)}, toAppendTo, pos);</span>
    }

    /**
     * Formats provided measurement value and unit into a string representation.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @return string representation of provided measurement value and unit.
     */
    public String format(double value, U unit) {
<span class="fc" id="L169">        return format(new BigDecimal(value), unit);</span>
    }

    /**
     * Formats provided measurement value and unit into a string representation
     * and appends the result into provided string buffer.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @param toAppendTo buffer to append the result to.
     * @param pos field position where result will be appended.
     * @return provided string buffer where result is appended.
     */
    public StringBuffer format(double value, U unit,
                               StringBuffer toAppendTo, FieldPosition pos) {
<span class="fc" id="L183">        return format(new BigDecimal(value), unit, toAppendTo, pos);</span>
    }

    /**
     * Formats provided measurement into a string representation.
     * @param measurement a measurement.
     * @return string representation of provided measurement.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public String format(M measurement) {
<span class="fc" id="L193">        return format(measurement.getValue(), (U)measurement.getUnit());</span>
    }

    /**
     * Formats provided measurement into a string representation and appends the
     * result into provided string buffer.
     * @param measurement a measurement.
     * @param toAppendTo buffer to append the result to.
     * @param pos field position where result will be appended.
     * @return provided string buffer where result is appended.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public StringBuffer format(M measurement, StringBuffer toAppendTo,
                               FieldPosition pos) {
<span class="fc" id="L207">        return format(measurement.getValue(), (U)measurement.getUnit(),</span>
                toAppendTo, pos);
    }

    /**
     * Formats and converts provided measurement value and unit using unit system
     * assigned to locale of this instance (if no locale has been provided it
     * is assumed that the system default locale is used).
     * If provided value is too large for provided unit, this method will
     * convert it to a more appropriate unit.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @return a string representation of measurement value and unit.
     */
    public String formatAndConvert(Number value, U unit) {
<span class="fc" id="L222">        return formatAndConvert(value, unit, getUnitSystem());</span>
    }

    /**
     * Formats and converts provided measurement value and unit using unit system
     * assigned to locale of this instance (if no locale has been provided it
     * is assumed that the system default locale is used).
     * If provided value is too large for provided unit, this method will
     * convert it to a more appropriate unit.
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @return a string representation of measurement value and unit.
     */
    public String formatAndConvert(double value, U unit) {
<span class="fc" id="L236">        return formatAndConvert(new BigDecimal(value), unit);</span>
    }

    /**
     * Formats and converts provided measurement using unit system assigned to
     * locale of this instance (if no locale has been provided it is assumed
     * that the system default locale is used).
     * If provided measurement value is too large for its unit, this method
     * will convert it to a more appropriate unit.
     * @param measurement measurement to be formatted.
     * @return a string representation of measurement value and unit.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public String formatAndConvert(M measurement) {
<span class="fc" id="L250">        return formatAndConvert(measurement.getValue(),</span>
<span class="fc" id="L251">                (U)measurement.getUnit());</span>
    }

    /**
     * Formats and converts provided measurement value and unit using provided
     * unit system.
     * If provided value is too large for provided unit, this method will
     * convert it to a more appropriate unit using provided unit system (either
     * metric or imperial).
     * @param value a measurment value.
     * @param unit a measurement unit.
     * @param system system unit to convert measurement to.
     * @return a string representation of measurement value and unit.
     */
    public abstract String formatAndConvert(Number value, U unit, UnitSystem system);

    /**
     * Formats and converts provided measurement value and unit using provided
     * unit system.
     * If provided value is too large for provided unit, this method will
     * convert it to a more appropriate unit using provided unit system (either
     * metric or imperial).
     * @param value a measurement value.
     * @param unit a measurement unit.
     * @param system system unit to convert measurement to.
     * @return a string representation of measurement value and unit.
     */
    public String formatAndConvert(double value, U unit, UnitSystem system) {
<span class="fc" id="L279">        return formatAndConvert(new BigDecimal(value), unit, system);</span>
    }

    /**
     * Formats and converts provided measurement using provided unit system.
     * If provided measurement value is too large for its unit, this method
     * will convert it to a more appropriate unit using provided unit
     * system.
     * @param measurement a measurement to be formatted.
     * @param unitSystem system unit to convert measurement to.
     * @return a string representation of measurement value and unit.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public String formatAndConvert(M measurement, UnitSystem unitSystem) {
<span class="fc" id="L293">        return formatAndConvert(measurement.getValue(),</span>
<span class="fc" id="L294">                (U)measurement.getUnit(), unitSystem);</span>
    }

    /**
     * Returns available locales for this formatter.
     * @return available locales.
     */
    public static Locale[] getAvailableLocales() {
<span class="fc" id="L302">        return NumberFormat.getAvailableLocales();</span>
    }

    /**
     * Gets locale assigned to this instance.
     * Locale determines number format and unit system (metric or imperial)
     * if not specified.
     * @return a locale.
     */
    public Locale getLocale() {
<span class="fc" id="L312">        return mLocale;</span>
    }

    /**
     * Returns maximum fraction digits to be shown when formatting a measure.
     * @return maximum fraction digits.
     */
    public int getMaximumFractionDigits() {
<span class="fc" id="L320">        return mNumberFormat.getMaximumFractionDigits();</span>
    }

    /**
     * Sets maximum fraction digits to use when formatting a measure.
     * @param newValue maximum fraction digits to be set.
     */
    public void setMaximumFractionDigits(int newValue) {
<span class="fc" id="L328">        mNumberFormat.setMaximumFractionDigits(newValue);</span>
<span class="fc" id="L329">    }</span>

    /**
     * Returns maximum integer digits to be shown when formatting a measure.
     * @return maximum integer digits.
     */
    public int getMaximumIntegerDigits() {
<span class="fc" id="L336">        return mNumberFormat.getMaximumIntegerDigits();</span>
    }

    /**
     * Sets maximum integer digits to use when formatting a measure.
     * @param newValue maximum integer digits to be set.
     */
    public void setMaximumIntegerDigits(int newValue) {
<span class="fc" id="L344">        mNumberFormat.setMaximumIntegerDigits(newValue);</span>
<span class="fc" id="L345">    }</span>

    /**
     * Returns minimum fraction digits to be shown when formatting a measure.
     * @return minimum fraction digits.
     */
    public int getMinimumFractionDigits() {
<span class="fc" id="L352">        return mNumberFormat.getMinimumFractionDigits();</span>
    }

    /**
     * Sets minimum fraction digits to use when formatting a measure.
     * @param newValue minimum fraction digits to be set.
     */
    public void setMinimumFractionDigits(int newValue) {
<span class="fc" id="L360">        mNumberFormat.setMinimumFractionDigits(newValue);</span>
<span class="fc" id="L361">    }</span>

    /**
     * Returns minimum integer digits to be shown when formatting a measure.
     * @return minimum integer digits.
     */
    public int getMinimumIntegerDigits() {
<span class="fc" id="L368">        return mNumberFormat.getMinimumIntegerDigits();</span>
    }

    /**
     * Sets minimum integer digits to use when formatting a measure.
     * @param newValue minimum integer digits to be set.
     */
    public void setMinimumIntegerDigits(int newValue) {
<span class="fc" id="L376">        mNumberFormat.setMinimumIntegerDigits(newValue);</span>
<span class="fc" id="L377">    }</span>

    /**
     * Returns rounding mode to be used when formatting a measure.
     * @return rounding mode to be used when formatting a measure.
     */
    public RoundingMode getRoundingMode() {
<span class="fc" id="L384">        return mNumberFormat.getRoundingMode();</span>
    }

    /**
     * Specifies rounding mode to use when formatting a measure.
     * @param roundingMode rounding mode to be set.
     */
    public void setRoundingMode(RoundingMode roundingMode) {
<span class="fc" id="L392">        mNumberFormat.setRoundingMode(roundingMode);</span>
<span class="fc" id="L393">    }</span>

    /**
     * Indicates if grouping is used when formatting a measure.
     * @return true if grouping is used, false otherwise.
     */
    public boolean isGroupingUsed() {
<span class="fc" id="L400">        return mNumberFormat.isGroupingUsed();</span>
    }

    /**
     * Sets if grouping is used when formatting a measure.
     * @param newValue true if grouping is enabled, false otherwise.
     */
    public void setGroupingUsed(boolean newValue) {
<span class="fc" id="L408">        mNumberFormat.setGroupingUsed(newValue);</span>
<span class="fc" id="L409">    }</span>

    /**
     * Indicates if only integer values are parsed.
     * @return true if only integer values are parsed, false otherwise.
     */
    public boolean isParseIntegerOnly() {
<span class="fc" id="L416">        return mNumberFormat.isParseIntegerOnly();</span>
    }

    /**
     * Specifies whether only integer values are parsed or not.
     * @param value if true only integer values will be parsed.
     */
    public void setParseIntegerOnly(boolean value) {
<span class="fc" id="L424">        mNumberFormat.setParseIntegerOnly(value);</span>
<span class="fc" id="L425">    }</span>

    /**
     * Obtains pattern to format values and unit together into a single string.
     * {0} corresponds to the value, {1} corresponds to the unit part.
     * @return pattern to format values and unit together.
     */
    public String getValueAndUnitFormatPattern() {
<span class="fc" id="L433">        return mValueAndUnitFormatPattern;</span>
    }

    /**
     * Sets pattern to format values and unit together into a single string.
     * {0} corresponds to the value, {1} corresponds to the unit part.
     * @param valueAndUnitFormatPattern pattern to format values and unit
     * together.
     * @throws IllegalArgumentException if provided pattern is null.
     */
    public void setValueAndUnitFormatPattern(String valueAndUnitFormatPattern)
            throws IllegalArgumentException {
<span class="fc bfc" id="L445" title="All 2 branches covered.">        if (valueAndUnitFormatPattern == null) {</span>
<span class="fc" id="L446">            throw new IllegalArgumentException();</span>
        }
<span class="fc" id="L448">        mValueAndUnitFormatPattern = valueAndUnitFormatPattern;</span>
<span class="fc" id="L449">    }</span>

    /**
     * Returns unit system this instance will use based on its assigned locale.
     * Notice that if no locale was assigned, then the default system locale
     * will be used.
     * @return unit system this instance will use.
     */
    public UnitSystem getUnitSystem() {
<span class="fc" id="L458">        return UnitLocale.getFrom(mLocale);</span>
    }

    /**
     * Indicates whether provided string representation contains a valid
     * measurement unit or not.
     * @param source a string measurement representation to be checked.
     * @return true if provided string has a valid (i.e. recognized) unit, false
     * otherwise.
     */
    public boolean isValidUnit(String source) {
<span class="fc bfc" id="L469" title="All 2 branches covered.">        return findUnit(source) != null;</span>
    }

    /**
     * Indicates whether provided string representation is a valid measurement
     * representation or not.
     * @param source a string measurement representation to be checked.
     * @return true if provided string representation is valid (contains valid
     * value and unit), false otherwise.
     */
    public boolean isValidMeasurement(String source) {
        try {
<span class="fc" id="L481">            mNumberFormat.parse(source);</span>
<span class="fc" id="L482">            return isValidUnit(source);</span>
<span class="fc" id="L483">        } catch (ParseException e) {</span>
<span class="fc" id="L484">            return false;</span>
        }
    }

    /**
     * Indicates whether provided string representation of a measurement
     * contains a metric system unit.
     * @param source a measurement string representation to be checked.
     * @return true if found unit is metric, false otherwise or if unit
     * cannot be determined.
     */
    public boolean isMetricUnit(String source) {
<span class="fc bfc" id="L496" title="All 2 branches covered.">        return getUnitSystem(source) == UnitSystem.METRIC;</span>
    }

    /**
     * Indicates whether provided string representation of a measurement
     * contains an imperial system unit.
     * @param source a measurement string representation to be checked.
     * @return true if found unit is imperial, false otherwise or if unit
     * cannot be determined.
     */
    public boolean isImperialUnit(String source) {
<span class="fc bfc" id="L507" title="All 2 branches covered.">        return getUnitSystem(source) == UnitSystem.IMPERIAL;</span>
    }

    /**
     * Gets unit system for detected unit into provided string representation
     * of a measurement.
     * @param source a measurement string representation to be checked.
     * @return a unit system (either metric or imperial) or null if unit
     * cannot be determined.
     */
    public abstract UnitSystem getUnitSystem(String source);

    /**
     * Parses a string into a measure.
     * @param source text to be parsed.
     * @return a measure containing measure value and unit obtained from parsed
     * text.
     * @throws ParseException if parsing failed.
     * @throws UnknownUnitException if unit cannot be determined.
     */
    public abstract M parse(String source) throws ParseException, UnknownUnitException;

    /**
     * Finds measure unit from within a measurement string representation.
     * @param source a measurement string representation.
     * @return a measure unit or null if none can be determined.
     */
    public abstract U findUnit(String source);

    /**
     * Obtains measure unit symbol.
     * @param unit a measure unit.
     * @return measure unit symbol.
     */
    public abstract String getUnitSymbol(U unit);

    /**
     * Internal method to parse a string into a measure.
     * @param source text to be parsed.
     * @param measure a measure to be initialized with parsed contents.
     * @return provided measure.
     * @throws ParseException if parsing failed.
     * @throws UnknownUnitException if unit cannot be determined.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    M internalParse(String source, M measure) throws ParseException,
            UnknownUnitException {
<span class="fc" id="L554">        measure.setValue(mNumberFormat.parse(source));</span>
        try {
<span class="fc" id="L556">            measure.setUnit(findUnit(source));</span>
<span class="fc" id="L557">        } catch (IllegalArgumentException e) {</span>
<span class="fc" id="L558">            throw new UnknownUnitException(e);</span>
<span class="fc" id="L559">        }</span>
<span class="fc" id="L560">        return measure;</span>
    }

    /**
     * Internal method to clone this measure formatter.
     * @param copy an instantiated copy of a measure formatter that needs to be initialized.
     * @return provided copy.
     */
    MeasureFormatter&lt;M, U&gt; internalClone(MeasureFormatter&lt;M, U&gt; copy) {
<span class="fc" id="L569">        copy.mNumberFormat = (NumberFormat)mNumberFormat.clone();</span>
<span class="fc bfc" id="L570" title="All 2 branches covered.">        if (mFormat != null) {</span>
<span class="fc" id="L571">            copy.mFormat = (MessageFormat)mFormat.clone();</span>
        }
<span class="pc bpc" id="L573" title="1 of 2 branches missed.">        if (mLocale != null) {</span>
<span class="fc" id="L574">            copy.mLocale = (Locale)mLocale.clone();</span>
        }
<span class="fc" id="L576">        return copy;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>